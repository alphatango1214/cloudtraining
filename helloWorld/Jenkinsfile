pipeline {

    agent any

 

    options {

        buildDiscarder(logRotator(numToKeepStr: '5', daysToKeepStr: '5'))

        timestamps()

    }

 

    environment {

        registryCredential = credentials('docker_hub')

    }

 

    stages {

        stage('Build') {

            steps {

                script {

                    sh "docker build -t alphatango1214/test:${BUILD_NUMBER} ."

                }

            }

        }

        stage('Login to Docker Hub') {

            steps {

                script {

                    sh "echo $registryCredential_PSW | docker login -u $registryCredential_USR --password-stdin"

                }

            }

        }

 

        stage('Push Image') {

            steps {

                script {

                    sh "docker push alphatango1214/test:${BUILD_NUMBER}"

                }

            }

        }

    }

}
